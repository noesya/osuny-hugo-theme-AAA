<div class="gallery">
  {{ range .images }}
    {{ if .id }}
      {{- $image := partial "GetMedia" .id -}}
      {{- $image_class := printf "image-%s" (partial "GetImageDirection" .) -}}
      {{- if $image -}}
        <figure role="figure" class="{{ $image_class  }}" {{- with or .text .alt .credit }} aria-label="{{ . | plainify }}" {{ end }}>
          {{ partial "commons/image.html"
            (dict
              "image"    .file
              "alt"      .alt
              "sizes"    site.Params.image_sizes.blocks.gallery.large
            )}}
          {{ if not site.Params.image_sizes.design_system.lightbox.disabled }}
            {{ $lightbox_text := false }}
            {{ if and .text .credit }}
              {{ $lightbox_text = delimit (slice .text .credit) " | " }}
            {{ else if or .text .credit }}
              {{ $lightbox_text = or .text .credit }}
            {{ end }}
            
            {{ partial "commons/lightbox/lightbox-launcher.html" (dict
              "description" $lightbox_text
              "image" .id
              )
            }}
          {{ end }}
          {{ if or .text .credit }}
            <figcaption>
              {{ with .text }}
                <p>{{ . | safeHTML }}</p>
              {{ end }}
              {{ with .credit }}
                <div class="credit">{{ . | safeHTML }}</div>
              {{ end }}
            </figcaption>
          {{ end }}
        </figure>
      {{- end -}}
    {{ end }}
  {{ end }}
</div>
