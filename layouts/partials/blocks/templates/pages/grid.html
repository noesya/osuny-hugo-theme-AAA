{{ $show_descriptions := .show_descriptions }}
{{ $show_images := .show_images }}
{{ $article_heading := .article_heading }}

<div class="grid">
  {{ range .pages }}
    {{- $page := false -}}

    {{/*  Check if . is a map or page url  */}}
    {{ if reflect.IsMap . }}
      {{- if .page -}}
        {{- $page = partial "GetPageByUrl" .page -}}
      {{- else if .slug -}}
        {{/*  LEGACY  */}}
        {{- $page = partial "GetPageByUrl" .slug -}}
      {{ end }}
    {{ else }}
      {{- $page =  partial "GetPageByUrl" . -}}
    {{ end }}

    {{ with $page }}
      <article>
        {{- $article_heading.open -}}
          <a href="{{- .Permalink -}}">
            {{- partial "PrepareHTML" .Title -}}
          </a>
        {{- $article_heading.close -}}

        {{ if and $show_descriptions .Params.summary }}
          {{ if site.Params.pages.index.truncate_description }}
            <p>{{ partial "GetTruncateContent" ( dict 
              "text" .Params.summary
              "length" site.Params.pages.index.truncate_description
              ) }}</p>
          {{ else }}
            <p>{{ partial "PrepareHTML" .Params.summary }}</p>
          {{ end }}
        {{ end }}
        {{ if $show_images }}
          {{- partial "pages/page-media.html" . -}}
        {{ end }}
      </article>
    {{- end -}}
  {{ end }}
</div>