{{ $show_descriptions := .show_descriptions }}
{{ $show_images := .show_images }}

<div class="grid">
  {{ range .elements }}
    {{- $page := false -}}
    {{/*  Check if . is a map or page url, necessary when pages/grid is called outside block context */}}
    {{ if reflect.IsMap . }}
      {{- $page = partial "GetPageByUrl" .page -}}
    {{ else }}
      {{- $page =  partial "GetPageByUrl" . -}}
    {{ end }}

    <article>
      <h3>
        <a href="{{- .url -}}">
          {{- partial "PrepareHTML" .title -}}
        </a>
      </h3>
      {{ if and $show_descriptions .summary }}
        {{ if site.Params.pages.index.truncate_description }}
          <p>{{ partial "GetTruncateContent" ( dict 
            "text" .summary
            "length" site.Params.pages.index.truncate_description
            ) }}</p>
        {{ else }}
          <p>{{ partial "PrepareText" .summary }}</p>
        {{ end }}
      {{ end }}
      {{ if $show_images }}
        {{- partial "pages/page-media.html" . -}}
      {{ end }}
    </article>
  {{ end }}
</div>