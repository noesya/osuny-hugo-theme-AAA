{{ $heading_level := .heading_level | default 2 }}
{{ $id_title := "" }}
{{ if .block_index }}
  {{ $block_index := .block_index }}
  {{ $id_title = printf "id='block-%d'" $block_index }}
{{ end }}

{{/*  handle boolean issue  */}}
{{ if eq $heading_level false }}
  {{ $heading_level = 2 }}
{{ end }}

{{ $heading_tag := (dict 
  "open" ((printf "<h%d %s class='block-title'>" $heading_level $id_title) | safeHTML)
  "close" ((printf "</h%d>" $heading_level) | safeHTML)
)}}

{{ if or .title .description }}
  <div class="top {{ if .hidden }}hidden{{ end }}">
    {{ if .title }}
      {{ $heading_tag.open }}
        {{- if .link -}}
          <a href="{{ .link }}">
        {{- end -}}
        {{ partial "PrepareHTML" .title }}
        {{- if .link -}}
          </a>
        {{- end -}}
      {{ $heading_tag.close }}
    {{ end }}
    {{ if .description }}
      <div class="description">
        {{- partial "PrepareHTML" .description -}}
      </div>
    {{ end }}
  </div>
{{ end }}