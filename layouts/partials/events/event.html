{{ $event := .event }}
{{ $layout := .layout | default "list" }}
{{ $heading := .heading | default "h2" }}
{{ $heading_tag := (dict 
    "open" ((printf "<%s itemprop='name' class='event-title'>" $heading) | safeHTML)
    "close" ((printf "</%s>" $heading) | safeHTML)
    ) }}
{{ $index := .index }}
{{ $alternate := .alternate }}
{{ $options := .options }}

{{ with $event }}
  <article class="event {{ if .Params.image }}event--with-image{{ end -}}" itemscope itemtype="https://schema.org/Event">
    <div class="event-content">
      {{- $title := partial "PrepareHTML" .Title -}}
      {{ if and $options.subtitle .Params.subtitle }}
        <hgroup>
      {{ end }}
      {{ $heading_tag.open }}
        <a href="{{ .Permalink }}" title="{{ safeHTML (i18n "commons.more_aria" (dict "Title" $title)) }}">{{ $title }}</a>
      {{ $heading_tag.close }}
      {{ if and $options.subtitle .Params.subtitle }}
          <p class="event-subtitle">{{ partial "PrepareText" .Params.subtitle }}</p>
        </hgroup>
      {{ end }}

      {{ $dates := .Params.dates }}
      {{ if and $options.dates (or $dates.computed.short $dates.computed.two_lines.short $dates.from.hour $dates.to.hour) }}
        <div class="event-schedule" itemprop="startDate" content="{{- if $dates.from.day -}}{{ $dates.from.day }}{{- end -}}{{- if $dates.from.hour -}}T{{ $dates.from.hour }}{{- end -}}">
          <p class="event-dates">
            {{ $formated_date := $dates.computed.two_lines.short }}
            {{ if ne $layout "list" }}
              {{ $formated_date = $dates.computed.short }}
            {{ end }}
            {{ with site.Params.events.date_format }}
              {{ $formated_date = time.Format . $dates.from.day }}
              {{ if ne $dates.from.day $dates.to.day }}
                {{ $formated_date = printf "<span>%s</span><span>%s</span>" $formated_date ( time.Format . $dates.to.day ) }}
              {{ end }}
            {{ end }}
            {{ partial "PrepareHTML" $formated_date }}
          </p>
          {{- if (or $dates.from.hour $dates.to.hour) }}
            <p class="event-time">
              {{ $hour := "" }}
              {{- with $dates.from.hour }}
                {{ $hour = . }}
                {{ with site.Params.events.time_format }}
                  {{ $hour = time.Format . (printf "2021-09-01T%s:00" $hour) }}
                {{ end }}
                <span>{{ $hour }}</span>
              {{ end -}}
              {{- with $dates.to.hour }}
              {{ $hour = . }}
              {{ with site.Params.events.time_format }}
                  {{ $hour = time.Format . (printf "2021-09-01T%s:00" $hour) }}
                {{ end }}
                <span>{{ $hour }}</span>
              {{ end -}}
            </p>
          {{ end -}}
        </div>
      {{ end }}
      {{ if and $dates.status $options.status }}
        <p class="event-status">
          {{ if eq $dates.status "current"}}
            {{- i18n "blocks.events.current" -}}
          {{ else if eq $dates.status "future" }}
            {{- i18n "blocks.events.future" -}}
          {{ else if eq $dates.status "archive" }}
            {{- i18n "blocks.events.archive" -}}
          {{ end }}
        </p>
      {{ end }}

      {{ if and $options.summary  .Params.summary }}
        <div class="event-description" itemprop="description">
          {{ partial "GetRichSummary" ( dict 
            "summary" .Params.summary
            "kind" "events"
          )}}
          {{ if eq $layout "large" }}
            <p class="more meta" aria-hidden="true">{{- i18n "commons.more" -}}</p>
          {{ end }}
        </div>
      {{ end }}

      {{ if $options.categories }}
        {{ partial "commons/categories" ( dict
          "context" .
          "kind" "event"
        )}}
      {{- end -}}
    </div>
    <div class="media">
      {{- if and $options.image .Params.image -}}
        {{- partial "commons/image.html"
            (dict
              "image"    .Params.image
              "sizes"    site.Params.image_sizes.sections.events.item
            ) -}}
      {{- else -}}
        {{- partial "commons/image-default.html" "events" -}}
      {{- end -}}
    </div>
  </article>
{{ end }}